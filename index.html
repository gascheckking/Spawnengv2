<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SpawnEngine ‚Äî Onchain Pack Factory</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg-primary: #020617;
      --bg-secondary: rgba(3, 7, 18, 0.96);
      --bg-tertiary: rgba(15, 23, 42, 0.98);
      --text-primary: #f9fafb;
      --text-secondary: #9ca3af;
      --accent: #38bdf8;
      --accent-2: #a855f7;
      --accent-soft: rgba(56, 189, 248, 0.16);
      --border: rgba(148, 163, 184, 0.4);
      --success: #22c55e;
      --danger: #f97373;
      --font-mono: "SF Mono", "Fira Code", monospace;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      background:
        radial-gradient(circle at 0% 0%, #0ea5e9 0, transparent 45%),
        radial-gradient(circle at 100% 0%, #a855f7 0, transparent 45%),
        radial-gradient(circle at 50% 100%, #22c55e 0, transparent 50%),
        #020617;
      color: var(--text-primary);
      font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      display: flex;
      justify-content: center;
      min-height: 100vh;
      padding: 0.8rem;
    }

    .app-frame {
      width: 100%;
      max-width: 480px;
      border-radius: 1.4rem;
      overflow: hidden;
      border: 1px solid rgba(148, 163, 184, 0.4);
      box-shadow:
        0 0 0 1px rgba(15, 23, 42, 0.7),
        0 18px 45px rgba(0, 0, 0, 0.95);
      background: linear-gradient(145deg, rgba(15, 23, 42, 0.96), rgba(2, 6, 23, 0.99));
      display: flex;
      flex-direction: column;
      backdrop-filter: blur(18px);
    }

    /* HEADER */

    .app-header {
      padding: 0.8rem 0.95rem;
      border-bottom: 1px solid rgba(148, 163, 184, 0.35);
      background:
        radial-gradient(circle at 0% 0%, rgba(56, 189, 248, 0.32) 0, transparent 55%),
        radial-gradient(circle at 100% 0%, rgba(168, 85, 247, 0.28) 0, transparent 50%),
        rgba(15, 23, 42, 0.98);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .brand {
      display: flex;
      flex-direction: column;
      gap: 0.15rem;
    }

    .brand-title {
      font-size: 1.05rem;
      font-weight: 800;
      letter-spacing: 0.07em;
      color: var(--accent);
      text-transform: uppercase;
    }

    .brand-sub {
      font-size: 0.7rem;
      color: var(--text-secondary);
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    .network-pill {
      padding: 0.2rem 0.6rem;
      border-radius: 999px;
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.92), rgba(15, 23, 42, 0.86));
      border: 1px solid rgba(148, 163, 184, 0.6);
      font-family: var(--font-mono);
      font-size: 0.65rem;
      color: var(--text-secondary);
      box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.9);
    }

    .btn {
      border-radius: 999px;
      border: 1px solid rgba(56, 189, 248, 0.9);
      background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.18), rgba(15, 23, 42, 0.96));
      padding: 0.38rem 0.95rem;
      font-size: 0.75rem;
      color: var(--accent);
      cursor: pointer;
      font-weight: 600;
      transition: background 0.18s, color 0.18s, border-color 0.18s, transform 0.08s, box-shadow 0.08s;
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
    }

    .btn::before {
      content: "‚óè";
      font-size: 0.55rem;
      color: rgba(45, 212, 191, 0.7);
    }

    .btn:hover {
      background: linear-gradient(135deg, #38bdf8, #22c55e);
      color: #020617;
      transform: translateY(-1px);
      box-shadow: 0 8px 20px rgba(56, 189, 248, 0.35);
    }

    .btn-small {
      padding: 0.25rem 0.7rem;
      font-size: 0.7rem;
    }
    .btn-small::before { content: ""; }

    .btn-ghost {
      border-color: rgba(148, 163, 184, 0.55);
      background: rgba(15, 23, 42, 0.96);
      color: var(--text-secondary);
    }
    .btn-ghost::before { content: ""; }

    .btn-ghost:hover {
      border-color: var(--accent);
      color: var(--accent);
      box-shadow: none;
    }

    /* TAB BAR */

    .tab-bar {
      display: flex;
      overflow-x: auto;
      border-bottom: 1px solid rgba(30, 64, 175, 0.75);
      background: radial-gradient(circle at top, rgba(30, 64, 175, 0.55), rgba(15, 23, 42, 0.98));
    }
    .tab-bar::-webkit-scrollbar { height: 0; width: 0; }

    .tab-btn {
      border: none;
      background: transparent;
      color: var(--text-secondary);
      padding: 0.55rem 0.7rem;
      font-size: 0.74rem;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      white-space: nowrap;
      display: flex;
      align-items: center;
      gap: 0.22rem;
      opacity: 0.7;
    }

    .tab-btn::before {
      content: "‚óè";
      font-size: 0.45rem;
      color: rgba(148, 163, 184, 0.7);
    }

    .tab-btn.active {
      color: var(--accent);
      border-bottom-color: var(--accent);
      opacity: 1;
    }

    .tab-btn.active::before { color: #22c55e; }

    /* STATUS / TICKER */

    .status-strip {
      padding: 0.35rem 0.7rem;
      background: rgba(15, 23, 42, 0.98);
      border-bottom: 1px solid rgba(31, 41, 55, 0.95);
      display: flex;
      justify-content: space-between;
      font-size: 0.7rem;
    }
    .status-left,
    .status-right {
      display: flex;
      gap: 0.55rem;
      align-items: center;
      color: var(--text-secondary);
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #4b5563;
      display: inline-block;
      margin-right: 0.2rem;
      box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.9);
    }
    .status-dot.on {
      background: var(--success);
      box-shadow: 0 0 6px rgba(34, 197, 94, 0.85);
    }

    .ticker {
      overflow: hidden;
      background: linear-gradient(90deg, rgba(15, 23, 42, 0.98), rgba(15, 23, 42, 0.96));
      border-bottom: 1px solid rgba(30, 64, 175, 0.7);
      font-family: var(--font-mono);
      font-size: 0.7rem;
      padding: 0.35rem 0;
    }
    .ticker-inner {
      white-space: nowrap;
      animation: ticker-scroll 22s linear infinite;
      padding-left: 100%;
      color: rgba(148, 163, 184, 0.95);
    }
    @keyframes ticker-scroll {
      from { transform: translateX(0); }
      to   { transform: translateX(-100%); }
    }

    /* MAIN / VIEW */

    .app-main {
      flex: 1;
      min-height: 0;
      padding: 0.75rem;
      overflow-y: auto;
      background: radial-gradient(circle at bottom, rgba(37, 99, 235, 0.32), rgba(15, 23, 42, 0.98));
    }

    .view-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .view-title {
      font-size: 0.95rem;
      font-weight: 600;
      margin: 0;
      letter-spacing: 0.03em;
      text-transform: uppercase;
      color: rgba(226, 232, 240, 0.95);
    }

    .view-sub {
      font-size: 0.7rem;
      color: var(--text-secondary);
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.25rem;
    }
    .chip {
      border-radius: 999px;
      padding: 0.18rem 0.6rem;
      font-size: 0.65rem;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.98);
      color: rgba(226, 232, 240, 0.9);
      cursor: pointer;
      opacity: 0.8;
    }
    .chip.active {
      border-color: var(--accent);
      background: radial-gradient(circle at top, rgba(56, 189, 248, 0.18), rgba(15, 23, 42, 0.98));
      opacity: 1;
    }

    .select {
      background: rgba(15, 23, 42, 0.96);
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      padding: 0.25rem 0.55rem;
      font-size: 0.68rem;
      color: var(--text-secondary);
    }

    .card-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 0.65rem;
    }
    @media (min-width: 480px) {
      .card-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }

    .card {
      background:
        radial-gradient(circle at top left, rgba(56, 189, 248, 0.13), transparent 60%),
        radial-gradient(circle at bottom right, rgba(94, 234, 212, 0.12), transparent 55%),
        rgba(15, 23, 42, 0.98);
      border-radius: 0.9rem;
      border: 1px solid rgba(148, 163, 184, 0.45);
      padding: 0.8rem;
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.85);
    }

    .card h3 {
      margin: 0 0 0.3rem;
      color: var(--accent);
      font-size: 0.9rem;
    }

    .card p {
      margin: 0.15rem 0;
      font-size: 0.72rem;
      color: var(--text-secondary);
    }

    .card-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 0.3rem;
      margin-top: 0.25rem;
      font-size: 0.65rem;
      color: var(--text-secondary);
    }

    .tag {
      border-radius: 999px;
      padding: 0.12rem 0.4rem;
      border: 1px solid rgba(148, 163, 184, 0.6);
      font-size: 0.62rem;
    }

    .tag-core { border-color: #38bdf8; color: #38bdf8; }
    .tag-artifact { border-color: #facc15; color: #facc15; }
    .tag-relic { border-color: #f97316; color: #f97316; }

    .metric-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 0.6rem;
    }

    .metric {
      background:
        radial-gradient(circle at top, rgba(56, 189, 248, 0.18), transparent 65%),
        rgba(15, 23, 42, 0.98);
      border-radius: 0.9rem;
      border: 1px solid rgba(148, 163, 184, 0.55);
      padding: 0.7rem;
      text-align: center;
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.9);
    }

    .metric .value {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--accent);
    }

    .metric .label {
      font-size: 0.7rem;
      color: var(--text-secondary);
    }

    /* ACCORDION / FORGE */

    .accordion {
      display: flex;
      flex-direction: column;
      gap: 0.45rem;
    }

    .accordion-item {
      border-radius: 0.8rem;
      border: 1px solid rgba(148, 163, 184, 0.45);
      background: rgba(15, 23, 42, 0.98);
      overflow: hidden;
    }

    .accordion-header {
      padding: 0.6rem 0.75rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      font-size: 0.78rem;
      color: rgba(226, 232, 240, 0.95);
    }

    .accordion-header span {
      display: flex;
      align-items: center;
      gap: 0.35rem;
    }

    .accordion-header small {
      font-size: 0.65rem;
      color: var(--text-secondary);
    }

    .accordion-arrow {
      font-size: 0.75rem;
      color: var(--text-secondary);
    }

    .accordion-content {
      padding: 0.6rem 0.75rem 0.7rem;
      font-size: 0.72rem;
      color: var(--text-secondary);
      display: none;
    }

    .accordion-item.open .accordion-content { display: block; }
    .accordion-item.open .accordion-arrow { transform: rotate(180deg); }

    /* PACK MAP */

    .packmap-wrap { margin-top: 0.5rem; }
    .packmap-canvas {
      width: 100%;
      height: 220px;
      background:
        radial-gradient(circle at center, rgba(15, 23, 42, 0.9), #020617),
        #020617;
      border-radius: 1rem;
      border: 1px solid rgba(148, 163, 184, 0.55);
      display: block;
      box-shadow: inset 0 0 50px rgba(15, 23, 42, 0.95);
    }

    /* PROFILE & TASKS */

    .profile-header {
      display: flex;
      flex-direction: column;
      gap: 0.3rem;
      margin-bottom: 0.6rem;
    }

    .profile-wallet {
      font-family: var(--font-mono);
      font-size: 0.72rem;
      color: var(--text-secondary);
    }

    .badge-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.3rem;
    }

    .badge {
      border-radius: 999px;
      padding: 0.18rem 0.6rem;
      font-size: 0.65rem;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background:
        radial-gradient(circle at top, rgba(56, 189, 248, 0.18), transparent 55%),
        rgba(15, 23, 42, 0.98);
      color: rgba(226, 232, 240, 0.95);
    }

    .xp-bar {
      height: 6px;
      border-radius: 999px;
      background: rgba(30, 64, 175, 0.7);
      overflow: hidden;
      margin-top: 0.3rem;
    }

    .xp-fill {
      height: 100%;
      background: linear-gradient(90deg, #22c55e, #38bdf8, #a855f7);
      width: 0%;
      transition: width 0.25s ease-out;
    }

    .task-list {
      list-style: none;
      padding: 0;
      margin: 0.4rem 0 0;
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }

    .task-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(15, 23, 42, 0.98);
      border-radius: 0.7rem;
      border: 1px solid rgba(148, 163, 184, 0.55);
      padding: 0.45rem 0.6rem;
      font-size: 0.7rem;
      color: var(--text-secondary);
    }

    .task-item.done {
      opacity: 0.6;
    }

    .task-label {
      display: flex;
      flex-direction: column;
      gap: 0.1rem;
    }

    .task-xp {
      color: var(--accent);
      font-size: 0.65rem;
    }

    /* FOOTER */

    .app-footer {
      padding: 0.6rem 0.75rem;
      border-top: 1px solid rgba(30, 64, 175, 0.7);
      background: radial-gradient(circle at bottom, rgba(30, 64, 175, 0.45), rgba(15, 23, 42, 0.98));
      font-size: 0.68rem;
      text-align: center;
      color: var(--text-secondary);
    }

    /* TOAST */

    .toast {
      position: fixed;
      left: 50%;
      bottom: 1.4rem;
      transform: translateX(-50%) translateY(120%);
      padding: 0.45rem 0.8rem;
      border-radius: 999px;
      background: rgba(17, 24, 39, 0.95);
      border: 1px solid rgba(56, 189, 248, 0.7);
      color: var(--text-primary);
      font-size: 0.7rem;
      display: flex;
      align-items: center;
      gap: 0.4rem;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.18s ease-out, transform 0.18s ease-out;
      z-index: 40;
    }

    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0%);
      pointer-events: auto;
    }

    .toast-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 6px rgba(56, 189, 248, 0.8);
    }

  </style>
</head>
<body>
  <div id="app" class="app-frame"></div>
  <div id="toast" class="toast">
    <span class="toast-dot"></span>
    <span id="toast-text"></span>
  </div>

  <script type="module">
    // --------------------------------------
    // MOCK MESH DATA (seed)
    // --------------------------------------
    const MOCK_EVENTS = [
      {
        id: "1",
        kind: "pack_open",
        label: "Genesis Pack #42",
        short: "GEN-42",
        series: "Genesis",
        rarity: "Core",
        owner: "0x1234...beef",
        tags: ["pull", "core"],
        score: 420,
        timestamp: Date.now() - 5000,
      },
      {
        id: "2",
        kind: "swap",
        label: "Shard ‚Üí Core",
        short: "S>C",
        series: "Genesis",
        rarity: "Shard",
        owner: "0x9999...aaaa",
        tags: ["swap"],
        score: 210,
        timestamp: Date.now() - 25000,
      },
      {
        id: "3",
        kind: "burn",
        label: "Burn 10 Fragments",
        short: "10xF",
        series: "Genesis",
        rarity: "Fragment",
        owner: "0xabcd...0001",
        tags: ["burn", "gamble"],
        score: 90,
        timestamp: Date.now() - 60000,
      },
      {
        id: "4",
        kind: "zora_buy",
        label: "ZoraPack Mythic Hit",
        short: "Z-MYT",
        series: "ZoraPacks",
        rarity: "Relic",
        owner: "0xdeaf...9999",
        tags: ["zora", "mythic_hit"],
        score: 9900,
        timestamp: Date.now() - 120000,
      },
      {
        id: "5",
        kind: "farcaster_cast",
        label: "Cast: ‚ÄúJust pulled an Artifact on Base‚Äù",
        short: "CAST",
        series: "Social",
        rarity: "Artifact",
        owner: "0xface...7777",
        tags: ["farcaster", "social"],
        score: 300,
        timestamp: Date.now() - 240000,
      },
    ];

    function getUnifiedActivity() {
      // framtida: ers√§tt med riktig onchain + API mesh
      return Promise.resolve(
        MOCK_EVENTS.slice().sort((a, b) => b.timestamp - a.timestamp)
      );
    }

    function computeStatsFromEvents(events) {
      const stats = {
        totalPacks: 0,
        fragments: 0,
        shards: 0,
        cores: 0,
        artifacts: 0,
        relics: 0,
        holderCount: 0,
        luckIndex: 0,
      };
      const holders = new Set();
      for (const e of events) {
        if (e.kind === "pack_open") stats.totalPacks++;
        switch (e.rarity) {
          case "Fragment": stats.fragments++; break;
          case "Shard": stats.shards++; break;
          case "Core": stats.cores++; break;
          case "Artifact": stats.artifacts++; break;
          case "Relic": stats.relics++; break;
        }
        holders.add(e.owner);
      }
      stats.holderCount = holders.size;
      stats.luckIndex =
        stats.relics * 120 +
        stats.artifacts * 40 +
        stats.cores * 5 +
        stats.shards * 1 -
        stats.fragments * 2;
      return stats;
    }

    function postCastMock(message, url) {
      console.log("[FAKE CAST]", message, url || "");
      return Promise.resolve({ ok: true, id: "fake_cast_id" });
    }

    // --------------------------------------
    // STATE
    // --------------------------------------
    const NETWORK_INFO = {
      name: "Base Sepolia",
      label: "Base ¬∑ Pack ecosystems",
    };

    const state = {
      wallet: null,
      connected: false,
      theme: "dark",
      currentTab: "trading",
      events: [],
      stats: null,
      tradingFilterKind: "all",
      tradingFilterRarity: "all",
      profile: {
        streakDays: 3,
        xp: 1250,
        level: 4,
        bestHit: "Relic (ZoraPack)",
      },
      daily: {
        tasks: [
          { id: "open-pack", label: "Open 1 pack", xp: 25, done: false },
          { id: "do-trade", label: "Do 1 trade / swap", xp: 20, done: false },
          { id: "cast-social", label: "Share 1 pull on-chain", xp: 30, done: false },
        ],
      },
    };

    const TABS = [
      "trading",
      "my-packs",
      "creator-forge",
      "pull-lab",
      "pack-maps",
      "warp-verified",
      "bubbles",
      "stats-engine",
      "deploy-center",
      "profile",
      "settings",
    ];

    function humanTabName(id) {
      return id
        .replace(/-/g, " ")
        .replace(/\b\w/g, (c) => c.toUpperCase());
    }

    // --------------------------------------
    // TOAST
    // --------------------------------------
    let toastTimer = null;
    function showToast(text) {
      const t = document.getElementById("toast");
      const span = document.getElementById("toast-text");
      span.textContent = text;
      t.classList.add("show");
      if (toastTimer) clearTimeout(toastTimer);
      toastTimer = setTimeout(() => {
        t.classList.remove("show");
      }, 2000);
    }

    // --------------------------------------
    // INIT
    // --------------------------------------
    async function init() {
      const root = document.getElementById("app");
      root.innerHTML = `
        <header class="app-header">
          <div class="brand">
            <div class="brand-title">SpawnEngine</div>
            <div class="brand-sub">Onchain Pack Factory ¬∑ Pack Mesh Protocol</div>
          </div>
          <div class="header-right">
            <div class="network-pill" id="network-pill">${NETWORK_INFO.label}</div>
            <button id="wallet-btn" class="btn">Connect</button>
          </div>
        </header>

        <nav class="tab-bar" id="tab-bar"></nav>

        <div class="status-strip">
          <div class="status-left">
            <span><span id="wallet-dot" class="status-dot"></span><span id="wallet-status">Wallet: Disconnected</span></span>
            <span>Theme: Dark</span>
          </div>
          <div class="status-right">
            <span>Gas: 0.26 gwei</span>
            <span>Mesh: Live</span>
          </div>
        </div>

        <div class="ticker">
          <div class="ticker-inner" id="ticker-inner"></div>
        </div>

        <main class="app-main">
          <div class="view-header">
            <div>
              <h2 class="view-title" id="view-title"></h2>
              <div class="view-sub" id="view-sub"></div>
            </div>
            <div class="chip-row" id="view-actions"></div>
          </div>
          <div id="view-body"></div>
        </main>

        <footer class="app-footer">
          SpawnEngine ¬∑ Base ¬∑ Zora ¬∑ Farcaster ¬∑ Multi-Module Pack Mesh
        </footer>
      `;

      setupTabs();
      setupWallet();

      state.events = await getUnifiedActivity();
      state.stats = computeStatsFromEvents(state.events);

      renderTicker();
      switchView("trading");
    }

    function setupTabs() {
      const bar = document.getElementById("tab-bar");
      bar.innerHTML = "";
      TABS.forEach((id) => {
        const btn = document.createElement("button");
        btn.className = "tab-btn";
        btn.dataset.tab = id;
        btn.textContent = humanTabName(id);
        btn.addEventListener("click", () => switchView(id));
        bar.appendChild(btn);
      });
      const first = bar.querySelector(".tab-btn");
      if (first) first.classList.add("active");
    }

    function setActiveTab(id) {
      document.querySelectorAll(".tab-btn").forEach((b) => {
        b.classList.toggle("active", b.dataset.tab === id);
      });
    }

    function setupWallet() {
      const btn = document.getElementById("wallet-btn");
      const status = document.getElementById("wallet-status");
      const dot = document.getElementById("wallet-dot");

      btn.addEventListener("click", () => {
        state.connected = !state.connected;
        state.wallet = state.connected
          ? "0x" + Math.random().toString(16).slice(2, 8) + "...mesh"
          : null;

        btn.textContent = state.connected ? "Disconnect" : "Connect";
        status.textContent = state.connected
          ? "Wallet: " + state.wallet
          : "Wallet: Disconnected";
        dot.classList.toggle("on", state.connected);
        showToast(state.connected ? "Wallet connected (mock)" : "Wallet disconnected");
      });
    }

    function renderTicker() {
      const el = document.getElementById("ticker-inner");
      const line = state.events
        .map((e) => e.short + " ¬∑ " + e.rarity + " ¬∑ " + e.owner)
        .join("   ‚Ä¢   ");
      el.textContent = line;
    }

    function switchView(id) {
      state.currentTab = id;
      setActiveTab(id);
      const title = document.getElementById("view-title");
      const sub = document.getElementById("view-sub");
      const body = document.getElementById("view-body");
      const actions = document.getElementById("view-actions");

      title.textContent = humanTabName(id);
      sub.textContent = "";
      actions.innerHTML = "";

      const map = {
        "trading": viewTrading,
        "my-packs": viewMyPacks,
        "creator-forge": viewCreatorForge,
        "pull-lab": viewPullLab,
        "pack-maps": viewPackMaps,
        "warp-verified": viewWarpVerified,
        "bubbles": viewBubbles,
        "stats-engine": viewStatsEngine,
        "deploy-center": viewDeployCenter,
        "profile": viewProfile,
        "settings": viewSettings,
      };

      const renderer = map[id] || function () { return "<p>Not implemented yet.</p>"; };
      const result = renderer();
      body.innerHTML = result.html;
      sub.textContent = result.sub || "";

      if (result.actions && result.actions.length) {
        result.actions.forEach((a) => {
          const chip = document.createElement("button");
          chip.className = "chip" + (a.active ? " active" : "");
          chip.textContent = a.label;
          if (a.id) chip.dataset.actionChip = a.id;
          actions.appendChild(chip);
        });
      }

      if (id === "pack-maps") drawPackMap();
      if (id === "creator-forge") wireAccordions();
      if (id === "profile") updateXpBar();
    }

    // --------------------------------------
    // HELPERS / STATE
    // --------------------------------------
    function addMeshEvent(evt) {
      evt.id = "evt-" + (Date.now() + Math.random().toString(16).slice(2, 6));
      evt.timestamp = Date.now();
      state.events.unshift(evt);
      state.stats = computeStatsFromEvents(state.events);
      renderTicker();
      if (state.currentTab === "trading") switchView("trading");
      if (state.currentTab === "my-packs") switchView("my-packs");
      if (state.currentTab === "stats-engine") switchView("stats-engine");
    }

    function randomRarityForZoraPack() {
      const roll = Math.random();
      if (roll < 0.7) return "Fragment";
      if (roll < 0.88) return "Shard";
      if (roll < 0.96) return "Core";
      if (roll < 0.995) return "Artifact";
      return "Relic";
    }

    function wireAccordions() {
      document.querySelectorAll(".accordion-header").forEach((header) => {
        header.addEventListener("click", () => {
          const item = header.closest(".accordion-item");
          item.classList.toggle("open");
        });
      });
    }

    function updateXpBar() {
      const fill = document.querySelector(".xp-fill");
      if (!fill) return;
      // enkel level-scaling: 0‚Äì2000 xp per level
      const pct = Math.min(100, (state.profile.xp % 2000) / 2000 * 100);
      fill.style.width = pct + "%";
    }

    // --------------------------------------
    // VIEWS
    // --------------------------------------
    function filterEventsForTrading() {
      return state.events.filter((e) => {
        if (state.tradingFilterKind !== "all" && e.kind !== state.tradingFilterKind) return false;
        if (state.tradingFilterRarity !== "all" && e.rarity !== state.tradingFilterRarity) return false;
        return true;
      });
    }

    function viewTrading() {
      const events = filterEventsForTrading();
      const rows = events.map(function(e) {
        let icon = "üì¶";
        if (e.kind === "swap") icon = "üîÑ";
        if (e.kind === "burn") icon = "üî•";
        if (e.kind === "zora_buy") icon = "ü™ô";
        if (e.kind === "farcaster_cast") icon = "üì°";

        const rarityTagClass =
          e.rarity === "Relic" ? "tag tag-relic" :
          e.rarity === "Artifact" ? "tag tag-artifact" :
          e.rarity === "Core" ? "tag tag-core" :
          "tag";

        return (
          '<div class="card">' +
            "<h3>" + icon + " " + e.label + "</h3>" +
            "<p>Series: " + e.series + "</p>" +
            "<div class=\"card-meta\">" +
              "<span class=\"" + rarityTagClass + "\">" + e.rarity + "</span>" +
              "<span class=\"tag\">" + e.kind + "</span>" +
              "<span class=\"tag\">" + e.owner + "</span>" +
            "</div>" +
            '<div style="margin-top:0.45rem;display:flex;justify-content:space-between;align-items:center;gap:0.3rem;">' +
              '<button class="btn btn-small" data-share-id="' + e.id + '">Share pull</button>' +
              '<button class="btn btn-small btn-ghost" data-quick-trade="' + e.id + '">Quick trade</button>' +
            "</div>" +
          "</div>"
        );
      }).join("");

      const html = rows
        ? '<div class="card-grid">' + rows + "</div>"
        : "<p>No mesh events yet.</p>";

      return {
        sub: "Unified mesh feed ¬∑ pulls ¬∑ swaps ¬∑ burns ¬∑ social",
        html,
        actions: [
          { id: "feed-all", label: "All", active: state.tradingFilterKind === "all" },
          { id: "feed-packs", label: "Packs", active: state.tradingFilterKind === "pack_open" },
          { id: "feed-zora", label: "Zora", active: state.tradingFilterKind === "zora_buy" },
          { id: "feed-social", label: "Social", active: state.tradingFilterKind === "farcaster_cast" },
        ],
      };
    }

    function viewMyPacks() {
      const packs = state.events.filter(function(e) { return e.kind === "pack_open"; });
      if (!packs.length) {
        return {
          sub: "Your personal inventory view for all series",
          html: "<p>Inga packs √∂ppnade √§nnu.</p>",
          actions: [],
        };
      }
      const rows = packs.map(function(e) {
        return (
          '<div class="card">' +
            "<h3>üé¥ " + e.label + "</h3>" +
            "<p>Series: " + e.series + "</p>" +
            "<p>Rarity: " + e.rarity + "</p>" +
            "<p>Score: " + e.score + "</p>" +
          "</div>"
        );
      }).join("");

      return {
        sub: "Wallet-focused view driven av samma mesh",
        html: '<div class="card-grid">' + rows + "</div>",
        actions: [],
      };
    }

    function viewCreatorForge() {
      const html =
        '<div class="accordion">' +
          '<div class="accordion-item open">' +
            '<div class="accordion-header">' +
              '<span><strong>Step 1 ¬∑ Artwork & Packshell</strong><small>Upload / referens / frame</small></span>' +
              '<span class="accordion-arrow">‚ñº</span>' +
            '</div>' +
            '<div class="accordion-content">' +
              "<p>Definiera din visuella identitet: Tiny Legends, Foil Realms, SpawnEngine F1-pack, osv.</p>" +
              '<button class="btn btn-small" data-action="forge-art">Attach art (mock)</button>' +
            "</div>" +
          "</div>" +

          '<div class="accordion-item">' +
            '<div class="accordion-header">' +
              '<span><strong>Step 2 ¬∑ Rarity Grid</strong><small>Fragments ‚Üí Relics</small></span>' +
              '<span class="accordion-arrow">‚ñº</span>' +
            '</div>' +
            '<div class="accordion-content">' +
              "<p>S√§tt upp din rarity-tabell med Fragment / Shard / Core / Artifact / Relic.</p>" +
              "<p>V√§rden styrs senare fr√•n kontraktens config.</p>" +
              '<button class="btn btn-small" data-action="forge-rarity">Configure grid (mock)</button>' +
            "</div>" +
          "</div>" +

          '<div class="accordion-item">' +
            '<div class="accordion-header">' +
              '<span><strong>Step 3 ¬∑ Foil & Themes</strong><small>FX-lager / variants</small></span>' +
              '<span class="accordion-arrow">‚ñº</span>' +
            "</div>" +
            '<div class="accordion-content">' +
              "<p>V√§lj dina foil-lager: base shine, prism, holo, glitch, halloween, osv.</p>" +
              '<button class="btn btn-small" data-action="forge-foil">Select foil set (mock)</button>' +
            "</div>" +
          "</div>" +

          '<div class="accordion-item">' +
            '<div class="accordion-header">' +
              '<span><strong>Step 4 ¬∑ Deploy Plan</strong><small>Factory + Guard</small></span>' +
              '<span class="accordion-arrow">‚ñº</span>' +
            "</div>" +
            '<div class="accordion-content">' +
              "<p>Skapa din deploy-plan: pack price, treasury, split, tv√•-mythic-barrier via ReserveGuard.</p>" +
              '<button class="btn btn-small" data-action="forge-deploy">Generate deploy config (mock)</button>' +
            "</div>" +
          "</div>" +
        "</div>";

      return {
        sub: "From art ‚Üí rarity ‚Üí foil ‚Üí deploy, kopplad till PackFactory",
        html,
        actions: [],
      };
    }

    function viewPullLab() {
      const html =
        '<div class="card-grid">' +
          '<div class="card">' +
            "<h3>üî• Fragment Gamble</h3>" +
            "<p>Burn 10x Fragments ‚Üí chans p√• Shard/Core (XP, mesh update).</p>" +
            '<button class="btn" data-action="fragment-burn">Simulate Burn</button>' +
          "</div>" +
          '<div class="card">' +
            "<h3>‚ö° Shard Gamble</h3>" +
            "<p>Burn 3x Shards ‚Üí chans p√• Artifact/Relic (XP, mesh update).</p>" +
            '<button class="btn" data-action="shard-burn">Simulate Burn</button>' +
          "</div>" +
          '<div class="card">' +
            "<h3>ü™ô Zora Packs</h3>" +
            "<p>K√∂p ZoraPack ‚Üí rarity multipliers p√• Zora-value, kopplas till ZoraIndexOracle senare.</p>" +
            '<button class="btn" data-action="zora-pack">Open Zora Pack</button>' +
          "</div>" +
        "</div>";

      return {
        sub: "Gamble-moduler (Fragments / Shards / Zora packs), kopplade till UtilityRouter",
        html,
        actions: [],
      };
    }

    function viewPackMaps() {
      const html =
        '<div class="packmap-wrap">' +
          '<canvas id="packmap-canvas" class="packmap-canvas"></canvas>' +
        "</div>";
      return {
        sub: "Visualisering av rarity-distribution och mesh-puls",
        html,
        actions: [],
      };
    }

    function drawPackMap() {
      const canvas = document.getElementById("packmap-canvas");
      if (!canvas || !canvas.getContext) return;
      const ctx = canvas.getContext("2d");
      canvas.width = canvas.offsetWidth;
      canvas.height = canvas.offsetHeight;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for (let i = 0; i < 60; i++) {
        const x = Math.random() * canvas.width;
        const y = Math.random() * canvas.height;
        const r = Math.random() * 4 + 2;
        const rarityColors = ["#4b5563", "#60a5fa", "#a855f7", "#facc15", "#f97316"];
        ctx.fillStyle = rarityColors[Math.floor(Math.random() * rarityColors.length)];
        ctx.beginPath();
        ctx.arc(x, y, r, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    function viewWarpVerified() {
      const verified = state.events.filter(function(e) { return e.tags.indexOf("mythic_hit") !== -1; });
      if (!verified.length) {
        return {
          sub: "Warp Verified layer f√∂r mythic events & kreat√∂rer",
          html: "<p>Inga Warp Verified mythic hits √§nnu.</p>",
          actions: [],
        };
      }
      const rows = verified.map(function(e) {
        return (
          '<div class="card">' +
            "<h3>üîí " + e.label + "</h3>" +
            "<p>Owner: " + e.owner + "</p>" +
            "<p>Score: " + e.score + "</p>" +
          "</div>"
        );
      }).join("");

      return {
        sub: "Verifierade pulls & kreat√∂rer, kopplad till CreatorRegistry senare",
        html: '<div class="card-grid">' + rows + "</div>",
        actions: [],
      };
    }

    function viewBubbles() {
      const html =
        '<div class="card-grid">' +
          '<div class="card">' +
            "<h3>üìà Trending Tags</h3>" +
            "<p>#GenesisPacks ¬∑ #ZoraPack ¬∑ #RelicHit</p>" +
          "</div>" +
          '<div class="card">' +
            "<h3>üì° Social Cast</h3>" +
            "<p>Posta ett mock-cast till Farcaster (framtida Neynar-integration).</p>" +
            '<button class="btn" id="cast-btn">Post Mock Cast</button>' +
          "</div>" +
        "</div>";

      return {
        sub: "Social mesh-lager som kopplar packs ‚Üí Farcaster / X",
        html,
        actions: [],
      };
    }

    function viewStatsEngine() {
      const s = state.stats;
      if (!s) {
        return { sub: "Statistik baserad p√• Unified Activity Mesh", html: "<p>Stats loading...</p>", actions: [] };
      }
      const html =
        '<div class="metric-grid">' +
          '<div class="metric">' +
            '<div class="value">' + s.totalPacks + "</div>" +
            '<div class="label">Packs Opened</div>' +
          "</div>" +
          '<div class="metric">' +
            '<div class="value">' + s.cores + "</div>" +
            '<div class="label">Core Hits</div>' +
          "</div>" +
          '<div class="metric">' +
            '<div class="value">' + s.artifacts + "</div>" +
            '<div class="label">Artifacts</div>' +
          "</div>" +
          '<div class="metric">' +
            '<div class="value">' + s.relics + "</div>" +
            '<div class="label">Relics</div>' +
          "</div>" +
          '<div class="metric">' +
            '<div class="value">' + s.holderCount + "</div>" +
            '<div class="label">Unique Holders</div>' +
          "</div>" +
          '<div class="metric">' +
            '<div class="value">' + s.luckIndex + "</div>" +
            '<div class="label">Luck Index</div>' +
          "</div>" +
        "</div>";

      return {
        sub: "Luck, rarity, holders ‚Äì drivet direkt av mesh-eventen",
        html,
        actions: [],
      };
    }

    function viewDeployCenter() {
      const html =
        '<div class="card-grid">' +
          '<div class="card">' +
            "<h3>üèó Deploy Guard + Factory</h3>" +
            "<p>ReserveGuard + PackFactory p√• Base (via Hardhat / Foundry).</p>" +
            '<button class="btn" data-action="deploy-skeleton">Deploy Base Skeleton</button>' +
          "</div>" +
          '<div class="card">' +
            "<h3>üöÄ Deploy TokenPackSeries</h3>" +
            "<p>Starta en ny F1-pack-serie med din rarity-modell.</p>" +
            '<button class="btn" data-action="deploy-series">Launch Series</button>' +
          "</div>" +
          '<div class="card">' +
            "<h3>‚úÖ Creator Registry</h3>" +
            "<p>Framtida modul f√∂r Warp Verified kreat√∂rer & limits.</p>" +
            '<button class="btn" data-action="open-registry">Open Registry</button>' +
          "</div>" +
        "</div>";

      return {
        sub: "Onchain skeleton-lager: Factory, Series, Guard, Router",
        html,
        actions: [],
      };
    }

    function viewProfile() {
      const p = state.profile;
      const walletText = state.wallet || "0x‚Ä¶.not-connected";

      const tasksHtml = state.daily.tasks.map(function(t) {
        return (
          '<li class="task-item ' + (t.done ? "done" : "") + '">' +
            '<div class="task-label">' +
              "<span>" + t.label + "</span>" +
              '<span class="task-xp">+' + t.xp + " XP</span>" +
            "</div>" +
            '<button class="btn btn-small" data-task-id="' + t.id + '">' +
              (t.done ? "Done" : "Complete") +
            "</button>" +
          "</li>"
        );
      }).join("");
      const tasksDone = state.daily.tasks.filter(function(t) { return t.done; }).length;

      const html =
        '<div class="profile-header">' +
          "<div><strong>Spawn Profile</strong></div>" +
          '<div class="profile-wallet">' + walletText + "</div>" +
          '<div class="badge-row">' +
            '<span class="badge">üî• Streak: ' + p.streakDays + " days</span>" +
            '<span class="badge">‚≠ê XP: ' + p.xp + "</span>" +
            '<span class="badge">üèÖ Level ' + p.level + "</span>" +
            '<span class="badge">üéØ Best hit: ' + p.bestHit + "</span>" +
          "</div>" +
          '<div class="xp-bar"><div class="xp-fill"></div></div>' +
        "</div>" +

        '<div class="metric-grid" style="margin-top:0.5rem;">' +
          '<div class="metric">' +
            "<div class=\"value\">+25</div>" +
            '<div class="label">Daily XP Ready</div>' +
          "</div>" +
          '<div class="metric">' +
            '<div class="value">' + tasksDone + "/" + state.daily.tasks.length + "</div>" +
            '<div class="label">Tasks Done</div>' +
          "</div>" +
          '<div class="metric">' +
            "<div class=\"value\">3</div>" +
            '<div class="label">Quest Tier</div>' +
          "</div>" +
        "</div>" +

        '<div class="card" style="margin-top:0.6rem;">' +
          "<h3>üìã Daily Tasks</h3>" +
          '<ul class="task-list">' + tasksHtml + "</ul>" +
        "</div>" +

        '<div class="card" style="margin-top:0.6rem;">' +
          "<h3>üì§ Share Latest Pull</h3>" +
          "<p>Skicka din senaste Core/Relic-pull som cast (mock) till social-mesh.</p>" +
          '<button class="btn" id="share-latest">Share latest pull</button>' +
        "</div>";

      return {
        sub: "Din onchain vardag: streaks, XP, quests, social",
        html,
        actions: [],
      };
    }

    function viewSettings() {
      const html =
        '<div class="card-grid">' +
          '<div class="card">' +
            "<h3>üé® Theme</h3>" +
            "<p>Dark mode aktiverad. (Light disabled tills vidare.)</p>" +
            '<button class="btn btn-small btn-ghost">Toggle Theme (disabled)</button>' +
          "</div>" +
          '<div class="card">' +
            "<h3>üåê Network</h3>" +
            "<p>Aktiv kedja: " + NETWORK_INFO.name + "</p>" +
          "</div>" +
        "</div>";

      return {
        sub: "Bas-settings tills riktiga wallet / network toggles kopplas in",
        html,
        actions: [],
      };
    }

    // --------------------------------------
    // GLOBAL CLICK HANDLER
    // --------------------------------------
    document.addEventListener("click", async function(e) {
      const target = e.target;

      // chips i Trading
      if (target && target.dataset && target.dataset.actionChip) {
        const id = target.dataset.actionChip;
        if (id === "feed-all") state.tradingFilterKind = "all";
        if (id === "feed-packs") state.tradingFilterKind = "pack_open";
        if (id === "feed-zora") state.tradingFilterKind = "zora_buy";
        if (id === "feed-social") state.tradingFilterKind = "farcaster_cast";
        switchView("trading");
      }

      // cast-knapp i Bubbles
      if (target && target.id === "cast-btn") {
        await postCastMock(
          "Just pulled a Core via SpawnEngine Mesh!",
          "https://spawn-engine.vercel.app"
        );
        showToast("Mock cast sent to Farcaster (console)");
      }

      // share pull i Trading
      if (target && target.dataset && target.dataset.shareId) {
        const id = target.dataset.shareId;
        const ev = state.events.find(function(ev) { return ev.id === id; });
        if (ev) {
          await postCastMock(
            "SpawnEngine pull: " + ev.label + " (" + ev.rarity + ")",
            "https://spawn-engine.vercel.app"
          );
          showToast("Pull shared (mock)");
          const t = state.daily.tasks.find(function(t) { return t.id === "cast-social"; });
          if (t && !t.done) {
            t.done = true;
            state.profile.xp += t.xp;
            if (state.currentTab === "profile") switchView("profile");
          }
        }
      }

      // quick trade (mock)
      if (target && target.dataset && target.dataset.quickTrade) {
        const id = target.dataset.quickTrade;
        const ev = state.events.find(function(ev) { return ev.id === id; });
        if (ev) {
          showToast("Quick trade opened (mock) for " + ev.short);
        }
      }

      // daily task complete
      if (target && target.dataset && target.dataset.taskId) {
        const id = target.dataset.taskId;
        const task = state.daily.tasks.find(function(t) { return t.id === id; });
        if (task && !task.done) {
          task.done = true;
          state.profile.xp += task.xp;
          if (state.profile.xp >= 1500) state.profile.level = 5;
          if (state.currentTab === "profile") {
            switchView("profile");
          }
          showToast("Task completed: " + task.label);
        }
      }

      // share latest pull
      if (target && target.id === "share-latest") {
        const latestPack = state.events.find(function(e) { return e.kind === "pack_open"; });
        if (latestPack) {
          await postCastMock(
            "SpawnEngine pull: " + latestPack.label + " (" + latestPack.rarity + ")",
            "https://spawn-engine.vercel.app"
          );
          showToast("Latest pull shared (mock)");
          const t = state.daily.tasks.find(function(t) { return t.id === "cast-social"; });
          if (t && !t.done) {
            t.done = true;
            state.profile.xp += t.xp;
            if (state.currentTab === "profile") switchView("profile");
          }
        } else {
          showToast("No pack_open events in mesh yet");
        }
      }

      // PullLab actions
      if (target && target.dataset && target.dataset.action) {
        const action = target.dataset.action;

        if (action === "fragment-burn") {
          addMeshEvent({
            kind: "burn",
            label: "Burn 10 Fragments (Lab)",
            short: "10xF",
            series: "Genesis",
            rarity: Math.random() < 0.3 ? "Core" : "Shard",
            owner: state.wallet || "0xlab...user",
            tags: ["burn", "lab"],
            score: 200
          });
          showToast("Fragment burn simulated");
          const t = state.daily.tasks.find(function(t) { return t.id === "do-trade"; });
          if (t && !t.done) {
            t.done = true;
            state.profile.xp += t.xp;
            if (state.currentTab === "profile") switchView("profile");
          }
        }

        if (action === "shard-burn") {
          addMeshEvent({
            kind: "burn",
            label: "Burn 3 Shards (Lab)",
            short: "3xS",
            series: "Genesis",
            rarity: Math.random() < 0.5 ? "Artifact" : "Core",
            owner: state.wallet || "0xlab...user",
            tags: ["burn", "lab"],
            score: 800
          });
          showToast("Shard burn simulated");
          const t = state.daily.tasks.find(function(t) { return t.id === "do-trade"; });
          if (t && !t.done) {
            t.done = true;
            state.profile.xp += t.xp;
            if (state.currentTab === "profile") switchView("profile");
          }
        }

        if (action === "zora-pack") {
          const rarity = randomRarityForZoraPack();
          addMeshEvent({
            kind: "pack_open",
            label: "ZoraPack Pull (" + rarity + ")",
            short: "ZP-" + rarity.toUpperCase().slice(0, 3),
            series: "ZoraPacks",
            rarity: rarity,
            owner: state.wallet || "0xzora...user",
            tags: ["zora", "pull"],
            score: rarity === "Relic" ? 10000 : rarity === "Artifact" ? 4000 : 500
          });
          showToast("ZoraPack opened (mock)");
          const t = state.daily.tasks.find(function(t) { return t.id === "open-pack"; });
          if (t && !t.done) {
            t.done = true;
            state.profile.xp += t.xp;
            if (state.currentTab === "profile") switchView("profile");
          }
        }

        if (action === "deploy-skeleton") {
          showToast("Skeleton deploy placeholder (Hardhat senare)");
        }

        if (action === "deploy-series") {
          showToast("Series deploy placeholder (TokenPackSeries)");
        }

        if (action === "open-registry") {
          showToast("CreatorRegistry view placeholder");
        }

        if (action === "start-forge" || action === "forge-art" || action === "forge-rarity" || action === "forge-foil" || action === "forge-deploy") {
          showToast("Creator Forge-step saved (mock)");
        }
      }
    });

    init();
  </script>
</body>
</html>